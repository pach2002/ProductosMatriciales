     1                                 %line 1+1 main.asm
     2                                 
     3                                 
     4                                 [section .data]
     5                                 
     6                                 
     7                                 
     8                                  EXIT_SUCCESS equ 0
     9                                  SYS_EXIT equ 60
    10                                 
    11                                 
    12                                  LF equ 10
    13                                  NULL equ 0
    14                                  TRUE equ 1
    15                                  FALSE equ 0
    16                                 
    17                                  STDIN equ 0
    18                                  STDOUT equ 1
    19                                  STDERR equ 2
    20                                 
    21                                  SYS_read equ 0
    22                                  SYS_write equ 1
    23                                  SYS_open equ 2
    24                                  SYS_close equ 3
    25                                  SYS_fork equ 57
    26                                  SYS_creat equ 85
    27                                  SYS_time equ 201
    28                                 
    29                                  O_CREATE equ 0x40
    30                                  O_TRUNC equ 0x200
    31                                  O_APPEND equ 0x400
    32                                 
    33                                  O_READONLY equ 000000
    34                                  O_WRITEONLY equ 000001
    35                                  O_READWRITE equ 000002
    36                                 
    37                                  S_IRUSR equ 00400
    38                                  S_IWUSR equ 00200
    39                                  S_IXUSR equ 00100
    40                                 
    41                                 
    42                                 
    43 00000000 0A00                    newline db LF, NULL
    44 00000002 0A456A656D706C6F20-     Header db LF, "Ejemplo de archivo de escritura", LF, LF, NULL
    45 00000002 646520617263686976-
    46 00000002 6F2064652065736372-
    47 00000002 69747572610A0A00   
    48 00000025 507275656261577269-     Filename db "PruebaWrite.txt", NULL
    49 00000025 74652E74787400     
    50 00000035 68747470733A2F2F77-     WWWAD db "https://www.google.com"
    51 00000035 77772E676F6F676C65-
    52 00000035 2E636F6D           
    53 0000004B 0A0A00                  db LF, LF, NULL
    54 0000004E 1800000000000000        Len dq $-WWWAD - 1
    55 00000056 00                      fileDesc db 0
    56                                 
    57 00000057 457363726974757261-     WriteDone db "Escritura completada", LF, NULL
    58 00000057 20636F6D706C657461-
    59 00000057 64610A00           
    60 0000006D 4572726F7220616C20-     ErrorMSG db "Error al abrir el archivo", LF, NULL
    61 0000006D 616272697220656C20-
    62 0000006D 6172636869766F0A00 
    63 00000088 4572726F7220616C20-     ErrorMSG1 db "Error al escribir el archivo", LF, NULL
    64 00000088 657363726962697220-
    65 00000088 656C20617263686976-
    66 00000088 6F0A00             
    67 000000A6 536920736520707564-     Exito db "Si se pudo", LF, NULL
    68 000000A6 6F0A00             
    69                                 
    70                                 
    71                                 [section .text]
    72                                 [global _start]
    73                                  _start:
    74                                 
    75                                 
    76 00000000 48C7C7[00000000]        mov rdi, Header
    77 00000007 E89D000000              call printString
    78                                 
    79                                 
    80                                 
    81                                  OpenInputFile:
    82 0000000C 48C7C055000000          mov rax, SYS_creat
    83 00000013 48C7C7[00000000]        mov rdi, Filename
    84 0000001A 48C7C6C0010000          mov rsi, S_IRUSR | S_IWUSR | S_IXUSR
    85 00000021 0F05                    syscall
    86                                 
    87 00000023 6683F800                cmp ax, 0
    88 00000027 7C57                    jl ErrorOpen
    89                                 
    90 00000029 48890425[00000000]      mov qword [fileDesc], rax
    91 00000031 48C7C7[00000000]        mov rdi, Exito
    92 00000038 E86C000000              call printString
    93                                 
    94                                 
    95                                 
    96                                 
    97                                 
    98                                 
    99 0000003D 48C7C001000000          mov rax, SYS_write
   100 00000044 488B3C25[00000000]      mov rdi, qword[fileDesc]
   101 0000004C 48C7C6[00000000]        mov rsi, WWWAD
   102 00000053 488B1425[00000000]      mov rdx, qword[Len]
   103 0000005B 0F05                    syscall
   104                                 
   105 0000005D 4883F800                cmp rax, 0
   106                                 
   107                                 
   108 00000061 7C2B                    jl ErrorWrite
   109                                 
   110 00000063 48C7C7[00000000]        mov rdi, WriteDone
   111 0000006A E83A000000              call printString
   112                                 
   113                                 
   114 0000006F 48C7C003000000          mov rax, SYS_close
   115 00000076 488B3C25[00000000]      mov rdi, qword [fileDesc]
   116 0000007E 0F05                    syscall
   117                                 
   118                                 
   119 00000080 EB1A                    jmp last
   120                                 
   121                                  ErrorOpen:
   122 00000082 48C7C7[00000000]        mov rdi, ErrorMSG
   123 00000089 E81B000000              call printString
   124 0000008E EB0C                    jmp last
   125                                 
   126                                  ErrorWrite:
   127 00000090 48C7C7[00000000]        mov rdi, ErrorMSG1
   128 00000097 E80D000000              call printString
   129 0000009C EBFE                    jmp last
   130                                 
   131                                 
   132                                 last:
   133 0000009E 48C7C03C000000          mov rax, SYS_EXIT
   134 000000A5 48C7C700000000          mov rdi, EXIT_SUCCESS
   135 000000AC 0F05                    syscall
   136                                 
   137                                 
   138                                 
   139                                 
   140                                 
   141                                 [global printString]
   142                                 printString:
   143                                 
   144 000000AE 53                      push rbx
   145                                 
   146                                 
   147 000000AF 4889FB                  mov rbx, rdi
   148 000000B2 48C7C200000000          mov rdx, 0
   149                                  countStrLoop:
   150 000000B9 803B00                  cmp byte [rbx], NULL
   151 000000BC 7406                    je countStrDone
   152 000000BE 48FFC2                  inc rdx
   153 000000C1 48FFC3                  inc rbx
   154 000000C4 EBF1                    jmp countStrLoop
   155                                 
   156                                  countStrDone:
   157 000000C6 4883FA00                cmp rdx, 0
   158 000000CA 7411                    je prtDone
   159                                 
   160                                 
   161 000000CC 48C7C001000000          mov rax, SYS_write
   162 000000D3 4889FE                  mov rsi, rdi
   163 000000D6 48C7C701000000          mov rdi, STDOUT
   164                                 
   165 000000DD 0F05                    syscall
   166                                 
   167                                 
   168                                 
   169                                  prtDone:
   170 000000DF 5B                      pop rbx
   171 000000E0 C3                      ret
   172                                 
